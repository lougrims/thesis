\Section{2 DoF model}

\Subsection{Non-dimensional equations of motion}

\par The model chosen for this simulation is a simple two degree of freedom, two dimension, point mass model. 
The aircraft is assumed to be a glider to simplify the optimization routine. 
With such assumption the equations of motion in the ground reference frame is :

\begin{equation}
	\begin{array}[c]{c}
		\ddot{x}= -L' \cdot sin(\gamma) + D' \cdot cos(\gamma) \\ 
		\ddot{z}= L' \cdot cos(\gamma) - D' \cdot sin(\gamma) - m \cdot g
	\end{array}
	\label{eqn:eqm}
\end{equation}

% should I include a figure with the reference frame, and angle definition?

\par The lift and drag are defined are: 

\begin{equation}
	\begin{array}[c]{c}
		L'= \frac{1}{2} \rho v^2 C_l \\ 
		D'= \frac{1}{2} \rho v^2 C_d 
	\end{array}
	\label{eqn:Cl_def}
\end{equation}

\par With $v$ being the relative wind for the vehicle.
% do I need to include this kind basic stuff?

\par Since this simulation is mainly concerned with Newtonian physics (rather than fluid phenomenons) the usual fluid dynamics non-dimensional variables make little sens.
Here the equations are normalized by the optimal glide speed and $g$, the gravitational acceleration.
This is more representative of the performances of the aircraft.

\par Following Lissaman's \cite{lissaman2005wind} implementation of the equation of motion we define $V^*$ the optimal glide speed for the aircraft. 
This speed is achieved at the optimal lift to drag ratio of the aircraft.
With $C_l^*$ and $C_d^*$ the angle of attack for the maximum lift to drag ratio and $\gamma$ the pitch angle with respect to the horizon the optimal glide speed is:

\begin{equation}
	\begin{array}[c]{c}
		\gamma^*= - atan(\frac{C_l^*}{C_d^*}) \\
		V^* = \sqrt{\frac{2mg}{\rho S (C_l^* cos(\gamma^*) - C_d^* sin(\gamma^*)}}
	\end{array}
	\label{eqn:glide_speed}
\end{equation}

\par From we define $U$ and $W$ the non dimensional horizontal and vertical speed in the inertial reference frame.

\begin{equation}
	\begin{array}[c]{c}
		U = \frac{\dot{x}}{V^*} \\
		V= \frac{\dot{z}}{V^*}
	\end{array}
	\label{eqn:non_dim_speed}
\end{equation}
The time is normalized by $g / V^*$.

\par Since the speed is seen as a fraction of the optimal glide speed it makes sens to also normalize the lift and drag coefficients by their corresponding values at the optimal lift to drag ratio.

\begin{equation}
	\begin{array}[c]{c}
		L= \frac{C_l}{C_l^*} \\
		D= \frac{C_d}{C_d^*} 
	\end{array}
	\label{eqn:non_dim_coef}
\end{equation}

\par Finally we introduce Q the dynamic pressure as:

\begin{equation}
	Q = \frac{L'}{MgL} = \frac{\frac{1}{2} \rho V^2 C_l C_l^* }{Mg}
	\label{eqn:dynamic_pressure}
\end{equation}

\par From there the equation of motion \ref{eqn:eqm} can be expressed as:

\begin{equation}
\begin{array}[c]{c}
	\frac{dU}{dT}= -LQ \cdot sin(\gamma) + DQ \cdot cos(\gamma) \\ 
	\frac{dW}{dT}= LQ \cdot cos(\gamma) - DQ \cdot sin(\gamma) - 1
	\end{array}
	\label{eqn:non_dim_eqm}
\end{equation}

With 

\begin{equation}
	\gamma = -atan(\frac{W-W_g}{U-U_g})
	\label{eqn:gamma_def}
\end{equation}

$W_g$ and $U_g$ are the vertical and horizontal wind speeds in the inertial reference frame.

\par Finally the remaining thing to consider is $Q$ the dynamic pressure. If we define the speed of the wind gust as $W_g$ and $U_g$ we can express:

\begin{equation}
	Q = V^2 = (W-W_g)^2 + (U-U_g)^2
	\label{eqn:q_def}
\end{equation}

\par With these definitions we have the basic formulation of our non-dimensional equation of motions, normalized by the performances at the optimal glide trajectory in a calm environment.

\Subsection{Lift and drag models}

\par The normalized equation of motion \ref{eqn:non_dim_eqm} are not accounting for the fluid dynamic part of the flight.
The most important factor for glide performance is the lift to drag ratio. 
In his paper, Lissaman \cite{Lissaman2007neutral} is using a relatively simple quadratic model for the relationship between lift and drag:

\begin{equation}
	D=\frac{Q}{2G}(1+L^2)
	\label{eqn:Lissaman_G}
\end{equation}

[CHECK THIS EQUATION !!!!!]

\par This simple model work relatively well for simple airfoil but is inadequate for more complex shapes.
For various reasons, small UAVs tend to have non classical designs such as blended wing body or flying wing shapes.
The advantages of these designs reside in bigger space available for the payload while keeping the drag low.
However the flying wing airfoil profiles have very different lift to drag characteristics compared to more classical airfoils.

\par To get the lift to drag curve of a typical flying wing a typical flying wing shape is tested in the XFLR5 software.

\begin{figure}[ht]
	\begin{center}
	\scalebox{0.5}            % rescale the figure by a factor of 0.8
 	{\includegraphics{./Figures/UAV.png}}
	\end{center}
	\caption{Flying wing UAV shape used in XLFR5}
	\label{fig:UAV}
\end{figure}

\par This software perform flow simulation over the aircraft with a panel based method. 
The simulation is performed on a range of angle of attack from negative XXXX degrees to to separation at XXXX degree.
Due to the presence of sharp edges at the tip of the wings the Reynolds number had to be limited to XXXX.
At each angle of attack the software automatically computed the steady lift and drag coefficients.

\par [GRAPH OF CL AND CD VS ALPHA !!!]

\par This results, while being arguably more realistic than a simple quadratic approach, are still only considering quasi-steady change in the angle of attack.
This limitation will be discussed more in depth in the result discussion section \ref{sec:results}.


\Section{Optimization process, cost function and constraints}

\Subsection{General consideration on optimization}
% Get some stuff from the MM544 class

\par The general principle for the optimization routines resides in defining a so called ``cost function'' that will represent a quantity we want to minimize.
While the algorithm tries to minimize this scalar, a series of constraints have to be respected. 
These constraints can represent physical limitations or system requirements.
The cost and constraints are expressed as functions of a set of system state variables.
The state variables can represent temporal or spatial values.
The optimization is performed in a sequential fashion where different algorithm are used to step from a set of values for the state variables to another. 

\par Optimization routines are divided into two families. 

\par The first method is the gradient method, it requires a good knowledge of the physics behind the problem.
The cost function as well as the constraints have to be explicitly defined.
In this method the gradient of the cost function and the constraints is used to determine the direction of the next step in the optimization.
Different algorithm are used to chose the step size, and sometime the direction of the previous step can influence the current step.
The gradients for either the cost function or the constraints do not have to be explicitly defined as modern optimization routines, such as the one included in Matlab, can perform numerical gradient estimation.
However putting user calculated gradient into the routine will significantly speed up the overall calculation.

\par The second method is using the so called ``evolutionary algorithms''. 
This method relies a lot less on knowing the underlying physical phenomenon.
Its basic principle is a ``try and see'' process.
Random changes are performed on the state variables and their effects on the cost function are assessed.
The best steps are selected as a starting point for the next generation.
While with this method each step is a lot less computation intensive than with the previous method, the number of steps is a lot higher.

\par The first method has been used in this optimization as it provides more insight on the physics behind the problem.
However it should be noted that the resulting ``optimal'' point is usually only assured to be \emph{a local} minimum of the cost function.
Several different starting states should be tested to ensure that the optimization converges toward a reasonable minimum.



\Subsection{Cost function}
\par Our problem here consists in optimizing the trajectory in a gusting environment to minimize energy lose.
The most obvious cost function would be something like

\begin{equation}
	- \frac{1}{2}m{V(T_f)}^2 - gX(T_f)
	\label{eqn:eni_cost_fun}
\end{equation}

Which would be equivalent to maximizing the total energy at the end of the gust.
However after testing this has shown to leave to much freedom to the algorithm. 
As a result the local minimum found are the result of trajectories such as very steep dives, clearly far from the optimum.

\par Once again we refer to the Lissaman paper \cite{Lissaman2007neutral} and chose, instead of minimizing energy loss for a given gust condition, to find the minimum gust amplitude to satisfy an energy neutral trajectory over the gust period.
This means that the cost function is the wind gust amplitude $W_a$, which will have to be added to the state vector in order to be explicit, and that the neutral energy trajectory will have to be added to the constraints

\Subsection{State vector and constraints formulation}

\par In our case a gust cycle of duration $T_f$ is divided into $N$ discrete instants $T_i$ (usually around 30).
At each of these points we need to know the state of the vehicle.
Since we are considering a two degree of freedom model the two positions $X$, $Z$ and speed $U$, $W$ variables are the most simple choices.
However this is not enough to describe the system completely, we also need to know what our input is going to be, in this case the lift available and where on the lift vs drag curve we are.
Theres is two possible choices for this.
If you consider only the quasi steady part, the angle of attack $\alpha$ seems obvious.
However since the drag is a function of the lift (the inverse is not true), it is possible to use only the $L$ to define our point on the lift to drag curve.
This allows us to use one less variable.

\par With this five variables defined at each considered time points the state and input vector look like:

\begin{equation}
	x= 
	\begin{bmatrix}
		\cdots \\
		X_i \\
		Z_i \\
		U_i \\
		W_i \\
		L_i \\
		\cdots \\
		W_a
	\end{bmatrix}
	\quad i \in [1,N]
	\label{eqn:big_vector}
\end{equation}

\par All this variables have to be constrained to achieve a realistic trajectory.
The first and most obvious constrain is done with the equation of motion \ref{eqn:non_dim_eqm}.
This equation has to be changed from a continuous differential equation to a discrete equation.
This is done by using the Simpson's 1/3rd rule as derived by Zhao \cite{zhao2004optimal}.

In order to satisfy the equations of motion we need to define the state variable at the time $T_i$:

\begin{equation}
	y_i= \begin{bmatrix}
		X_i \\
		Z_i \\
		U_i \\
		W_i 
	\end{bmatrix}
	\label{eqn:state_i}
\end{equation}

Then with $\dot{y_i}$ the derivative of the state variables, given by the equation of motion \ref{eqn:non_dim_eqm} and:

\begin{equation}
	\begin{array}[c]{c}
		y_m= \frac{1}{2}(y_k + Y_{k+1}) - \frac{1}{8}(\dot{y_{k+1}} - \dot{y_k})\delta t \\
		L_m=\frac{1}{2}(L_i + L_{i+1})
	\end{array}
	\label{eqn:simpson_middle}
\end{equation}

The condition to satisfy the equation of motion becomes

\begin{equation}
	0=y_{k+1} - y_k - \frac{1}{6}( \dot{y_k} + 4 \dot{y_m} + \dot{y_{k+1}})\delta t \quad \forall i \in [1,N-1]
	\label{eqn:simpson}
\end{equation}

\par Another constraint is on the neutral energy loop condition.
To account for that the initial and final $Z$ values are fixed at zero and the initial and final vertical and horizontal speeds are set to be equal.

\par Since we are looking at only one cycle, in order for it to be repeatable, we need to have a smooth transition from one to another.
This  means setting the derivative of the speed to be equal at the start and at the end of the cycle.

\begin{equation}
	\begin{array}[c]{c}
		W_2 - W_1 = W_N - W_{N-1} \\
		U_2 - U_1 = U_N - U_{N-1} 
	\end{array}
	\label{eqn:derivative_constraint}
\end{equation}

\par Finally the last set of constraint is on the physical limits of the aircraft.
Typically an aircraft flight envelope is limited by its maximum speed (depends on the dynamic pressure), its maximum load and its maximum lift (which determines the stalling speed).
Since our aircraft is will be flying around its optimal glide speed, over speeding isn't going to be an issue.
Moreover the drag increasing proportionally to the square of speed, high speeds will be avoided as much as possible by the optimization routine.
The limit on the load can conveniently be expressed as:

\begin{equation}
	L_i Q_i \leq g_max \quad \forall i \in [1,N]
	\label{eqn:load_constraint}
\end{equation}

With $g_max$ the maximum load in Gs.

% did I actually used that in my code? I think it wasn't necessary.

\par Finally the maximum lift condition can be expressed

\begin{equation}
	L_i \le \frac{C_l^{max}}{C_l^*} \quad \forall i \in [1,N]
	\label{eqn:lift_constraint}
\end{equation}

As it will be seen in section \ref{sec:results} the value of $C_l^{max}$ has a profound impact on the performances of the UAV.

\par It is also sometime advisable to limit $\gamma$ in the $\pm 90^{\circ}$ range to prevent loops and backtracking.


\Subsection{Matlab optimization function}

\par Matlab offers several ways of doing optimization.
Since this scripting language allows for easy parallelization, it is relatively painless to implement your own optimization code.
However in most cases, ``classical'' optimization problems, such as weight reduction, topology optimization or mechanism design are reducible to a set of linear  equations and constraints.
In our case the equations of motions as well as the lift and drag properties are not linear at all, and trying to linearize this problem would make any solution meaningless.
For this reason a already existing optimization function has been chosen.

\par Since non linear optimizations like that are a computation intensive process dedicated tools have been developed to tackle the problem.
SNOP is one of these software and seems to be widely use.
Another tool appearing in the literature is a Fortran library called NPSOL.
Since our laboratory's language of predilection is Matlab, the optimization toolbox from MathWorks will be used.

\par The optimization toolbox provides with a helpful function for non-linear optimization called \emph{fmincon()}.
This function needs an initial guest for the $x$ vector.
When using this function the initial guest has quite a big influence on the converging speed and on the local optimal solution found.
To account for that several educated guesses were made and tested for the different types of the wind profiles and gusts duration.
These guesses are refined as new results are obtained.


\Section{Results} \label{sec:results}

\Subsection{Typical trajectories}

\par We have three cases of wind gusts:

\begin{equation}
	\begin{array}[c]{c}
		U_g=0 \\ 
		W_g= W_a sin(2 \pi \frac{T}{T_g})
	\end{array}
	\label{eqn:vertical_gust}
\end{equation}


\begin{equation}
	\begin{array}[c]{c}
		U_g= W_a cos(2 \pi \frac{T}{T_g}) \\
		W_g= W_a sin(2 \pi \frac{T}{T_g})
	\end{array}
	\label{eqn:compound_gust}
\end{equation}


\begin{equation}
	\begin{array}[c]{c}
		U_g= W_a cos( 2 \pi \frac{T}{T_g}) \\
		W_g= 0
	\end{array}
	\label{eqn:horizontal_gust}
\end{equation}

\par The first 

\Subsection{Influence of the gust duration}


\begin{figure}[ht]
	\begin{center}
	{\includegraphics{./Figures/Vertical_wind_Tg4_Wg0p21.eps}}
	\end{center}
	\caption{Flying wing UAV shape used in XLFR5}
	\label{fig:deUAV}
\end{figure}
\Subsection{Maximum lift available effects}

